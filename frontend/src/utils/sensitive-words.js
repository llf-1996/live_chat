/**
 * 敏感词过滤模块
 * 用于过滤聊天消息中的敏感词汇，保护聊天环境健康
 */

// 敏感词库
const sensitiveWords = [
  // ========== 辱骂类 ==========
  // 常见脏话
  '傻逼', '傻b', '傻比', '煞笔', 'SB', 'sb', 'Sb', 'sB', '傻B',
  '操你妈', '草你妈', '日你妈', '肏', '操', '草泥马', '艹', 'cao',
  '去死', '该死', '找死', '作死', '死全家', '全家死光',
  '贱人', '婊子', '妓女', '鸡', '小姐', '卖淫',
  '杂种', '野种', '孽种', '狗杂种',
  '垃圾', '废物', '智障', '白痴', '脑残', '弱智', '低能', '残废',
  '滚', '滚蛋', '滚开', '滚犊子', '滚远点',
  
  // 家人问候
  '你妈', '你爸', '你娘', '你爷', '你奶',
  '王八蛋', '狗娘养的', '狗日的', '龟儿子', '龟孙子',
  '畜生', '禽兽', '人渣', '败类', '渣滓',
  
  // 动物侮辱
  '狗东西', '狗屎', '狗腿子', '走狗', '狗奴才',
  '猪狗不如', '猪头', '蠢猪', '死猪',
  '猴子', '猩猩', '畜牲',
  
  // 英文脏话
  'fuck', 'shit', 'bitch', 'ass', 'asshole', 
  'damn', 'hell', 'bastard', 'dick', 'pussy',
  'cunt', 'motherfucker', 'fxxk', 'sxxt',
  
  // ========== 色情淫秽类 ==========
  '色情', '黄色', '黄片', '毛片', 'AV', 'av',
  '裸聊', '裸照', '裸体', '裸露',
  '性爱', '做爱', '性交', '交配', '嫖娼', '援交',
  '自慰', '手淫', '撸管', '打飞机',
  '激情', '床戏', '春药', '伟哥',
  '约炮', '一夜情', '包养', '开房',
  '成人网', '色网', '黄网',
  
  // ========== 暴力类 ==========
  '杀人', '杀死', '弄死', '砍死', '捅死',
  '自杀', '自尽', '寻死', '上吊', '跳楼',
  '枪', '手枪', '步枪', '子弹', '炸弹', '爆炸',
  '砍', '捅', '刺杀', '谋杀', '行凶',
  '黑社会', '黑帮', '帮派', '火拼',
  
  // ========== 毒品赌博类 ==========
  '毒品', '吸毒', '贩毒', '冰毒', '海洛因', '大麻', 
  '摇头丸', 'K粉', '可卡因', '鸦片', '白粉',
  '赌博', '赌场', '赌钱', '赌球', '博彩',
  '六合彩', '时时彩', '彩票', '赛马',
  
  // ========== 诈骗类 ==========
  '诈骗', '骗钱', '骗子', '传销', '非法集资',
  '洗钱', '黑钱', '假币', '伪钞',
  '套现', '刷单', '刷信誉', '虚假交易',
  '钓鱼', '木马', '病毒', '黑客',
  
  // ========== 政治敏感类 ==========
  '反华', '台独', '藏独', '疆独', '港独',
  '分裂', '暴乱', '动乱', '颠覆', '政变',
  '反政府', '反动', '邪教', '法轮功',
  
  // ========== 其他不当内容 ==========
  '人体器官', '器官买卖', '代孕', '卵子', '精子',
  '假证', '假文凭', '办证', '刻章',
  '走私', '偷渡', '贩卖',
  '开发票', '发票代开',
  
  // 可扩展更多敏感词...
]

// 预编译正则表达式，提升性能（只编译一次）
let compiledRegex = null

/**
 * 构建优化的敏感词正则表达式
 * 使用单个正则匹配所有敏感词，大幅提升性能
 */
function buildSensitiveWordsRegex() {
  if (compiledRegex) return compiledRegex
  
  // 转义特殊字符并排序（长词优先，避免短词误匹配）
  const escapedWords = sensitiveWords
    .map(word => word.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'))
    .sort((a, b) => b.length - a.length) // 按长度降序，优先匹配长词
  
  // 使用 | 连接所有敏感词，创建单个正则
  const pattern = escapedWords.join('|')
  compiledRegex = new RegExp(pattern, 'gi')
  
  return compiledRegex
}

/**
 * 过滤敏感词，将敏感词替换为 ***
 * @param {string} text - 原始文本
 * @returns {string} - 过滤后的文本
 */
export function filterSensitiveWords(text) {
  if (!text || typeof text !== 'string') {
    return text
  }
  
  // 使用预编译的正则表达式，一次性替换所有敏感词
  const regex = buildSensitiveWordsRegex()
  return text.replace(regex, '***')
}

/**
 * 检查文本是否包含敏感词
 * @param {string} text - 待检查的文本
 * @returns {boolean} - 是否包含敏感词
 */
export function hasSensitiveWords(text) {
  if (!text || typeof text !== 'string') {
    return false
  }
  
  // 使用预编译的正则表达式，快速检测
  const regex = buildSensitiveWordsRegex()
  return regex.test(text)
}

